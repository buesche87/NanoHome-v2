{"dashboard":{"annotations":{"list":[{"$$hashKey":"object:196","builtIn":1,"datasource":{"type":"datasource","uid":"grafana"},"enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations \u0026 Alerts","target":{"limit":100,"matchAny":false,"tags":[],"type":"dashboard"},"type":"dashboard"}]},"editable":true,"fiscalYearStartMonth":0,"graphTooltip":0,"id":null,"links":[],"liveNow":false,"panels":[{"datasource":{"type":"influxdb","uid":"8iwjhe17z"},"gridPos":{"h":10,"w":6,"x":0,"y":0},"id":6,"options":{"code":{"language":"plaintext","showLineNumbers":false,"showMiniMap":false},"content":"\u0026nbsp;\u003ch3\u003eSchaltuhr\u003c/h3\u003e\r\n\u003chr /\u003e\r\n\u003ccenter\u003e\r\n\u003cselect class=\"newform\" id=\"timer_device\" onchange=\"timer_onchange()\" name=\"nanolist_timer\"\u003e\r\n\t\u003coption value=\"\" selected disabled\u003e-- Gerät --\u003c/option\u003e\r\n\u003c/select\u003e\r\n\u003c/p\u003e\r\n\u003cinput class=\"newform\" id=\"timer_ein\" placeholder=\"Ein / Auf (z.B. 08:00)\" onkeyup=\"timer_onkeyup(this)\" autocomplete=\"off\" /\u003e\r\n\u003c/p\u003e\r\n\u003cinput class=\"newform\" id=\"timer_aus\" placeholder=\"Aus / Ab (z.B. 20:00)\" onkeyup=\"timer_onkeyup(this)\" autocomplete=\"off\" /\u003e\r\n\u003c/p\u003e\r\n\u003cselect class=\"newform\" id=\"timer_day\"\u003e\r\n    \u003coption value=\"*\"\u003eTäglich\u003c/option\u003e\r\n    \u003coption value=\"1\"\u003eMontag\u003c/option\u003e\r\n    \u003coption value=\"2\"\u003eDienstag\u003c/option\u003e\r\n    \u003coption value=\"3\"\u003eMittwoch\u003c/option\u003e\r\n    \u003coption value=\"4\"\u003eDonnerstag\u003c/option\u003e\r\n    \u003coption value=\"5\"\u003eFreitag\u003c/option\u003e\r\n    \u003coption value=\"6\"\u003eSamstag\u003c/option\u003e\r\n    \u003coption value=\"0\"\u003eSonntag\u003c/option\u003e\r\n    \u003coption value=\"6-7\"\u003eWochenende\u003c/option\u003e\r\n    \u003coption value=\"1-5\"\u003eWerktags\u003c/option\u003e\r\n\u003c/select\u003e\r\n\u003c/p\u003e\r\n\u003cbutton title=\"Aktivieren\" id=\"timer_save\" class=\"newform\" onclick=\"cronman('add')\" disabled\u003eSave\u003c/button\u003e\r\n\u003cbutton title=\"Alle anzeigen\" if=\"timer_show\" class=\"newform\" onclick=\"cronman('show all')\"\u003eShow\u003c/button\u003e\r\n\u003cbutton title=\"Deaktivieren\" id=\"timer_delete\" class=\"newform\" onclick=\"cronman('remove')\" disabled\u003eDelete\u003c/button\u003e\r\n\u003c/center\u003e\r\n\u003c/div\u003e\r\n\r\n\u003cscript\u003e\r\n\tfunction cronman(param) {\r\n\t\tvar timerdevice = document.getElementById(\"timer_device\");\r\n\t\tvar timerdesc = timerdevice.options[timerdevice.selectedIndex].text;\r\n\t\tvar timerday = document.getElementById(\"timer_day\");\r\n\t\tvar timerdaydesc = timerday.options[timerday.selectedIndex].text;\r\n\t\tvar timeron = document.getElementById(\"timer_ein\").value;\r\n\t\tvar timeroff = document.getElementById(\"timer_aus\").value;\r\n\r\n\t\tif (timeron === \"\") {timeron = \"null\"}\r\n\t\tif (timeroff === \"\") {timeroff = \"null\"}\r\n\r\n\t\tvar timermessage = \"cronman \" + param + \" '\" + timerdevice.value + \"' '\" + timerdesc + \"' '\" + timerday.value + \"' '\" + timerdaydesc + \"' '\" + timeron + \"' '\" + timeroff + \"'\";\r\n\t\t\r\n\t\tpublish_timer(timermessage);\r\n\t};\r\n\r\n\tvar timer_onchange = function () {\r\n\t\tdocument.getElementById(\"timer_delete\").disabled = false;\r\n\t\ttimer_enable_save()\r\n\t\tcronman('show')\r\n\t}\r\n\r\n\tvar timer_onkeyup = function (inputField) {\r\n\r\n\t  var isValid = /^([0-1]?[0-9]|2[0-4])[.,:;\\s]([0-5][0-9])(:[0-5][0-9])?$/.test(inputField.value);\r\n\r\n    if (! isValid) {\r\n      inputField.value = \"\";\r\n    } \r\n\t\r\n\t\ttimer_enable_save()\r\n\t};\r\n\r\n\tvar timer_enable_save = function () {\r\n\t\tvar timerdevice = document.getElementById(\"timer_device\")\r\n\t\tvar timeron = document.getElementById(\"timer_ein\")\r\n\t\tvar timeroff = document.getElementById(\"timer_aus\")\r\n\r\n\t\tif ((timerdevice.value !== \"\" \u0026\u0026 timeron.value !== timeron.defaultValue ) || (timerdevice.value !== \"\" \u0026\u0026 timeroff.value !== timeroff.defaultValue )) {\r\n\t\t\tdocument.getElementById(\"timer_save\").disabled = false;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tdocument.getElementById(\"timer_save\").disabled = true;\r\n\t\t}\r\n\t};\r\n\r\n\t$(document).ready(function() {\r\n\t\t\t$('#timer_day').change(function() {\r\n\t\t\t\tvar current = $('#timer_day').val();\r\n\t\t\t\tif (current != 'null') {\r\n\t\t\t\t\t\t$('#select').css('color','white');\r\n\t\t\t\t\t\t$('#select').css('background-color','rgba(0,0,0,0.1)');\r\n\t\t\t\t} else {\r\n\t\t\t\t\t\t$('#select').css('color','white');\r\n\t\t\t\t\t\t$('#select').css('background-color','black');\r\n\t\t\t\t}\r\n\t\t\t}); \r\n\t});\r\n\r\n\u003c/script\u003e\r\n\r\n","mode":"html"},"pluginVersion":"10.1.5","targets":[{"datasource":{"type":"influxdb","uid":"8iwjhe17z"},"refId":"A"}],"type":"text"},{"datasource":{"type":"influxdb","uid":"8iwjhe17z"},"gridPos":{"h":24,"w":10,"x":7,"y":0},"id":8,"options":{"code":{"language":"plaintext","showLineNumbers":false,"showMiniMap":false},"content":"\u003chead\u003e\u003clink rel=\"stylesheet\" type=\"text/css\" href=\"../public/style.css\" /\u003e\u003c/head\u003e\r\n\r\n\u003ch3\u003eOutput\u003c/h3\u003e\r\n\u003chr /\u003e\r\n\r\n\u003cdiv style=\"position: fixed;\"\u003e\r\n\t\u003cdiv style=\"overflow-y: scroll; height: 600px;\"\u003e\r\n\t\u003cspan id=\"timer_output\" style=\"white-space: pre; font-family: monospace; display: block; unicode-bidi: embed; font-size: 14px;\"\u003e\u003c/span\u003e\r\n\t\u003c/div\u003e\r\n\u003c/div\u003e\r\n\r\n\u003cscript\u003e\r\n\t\r\n\tvar mqtt;\r\n\tvar reconnectTimeout = 5000;\r\n\tvar port = 1884;\r\n\tvar useTLS = false;\r\n\tvar user = \"\";\r\n\tvar pwd = \"\";\r\n\tvar cleansession = true;\r\n\tvar path = \"\";\r\n\tvar buttons = $('[type=button]');\r\n\tvar host = location.hostname;\r\n\t\r\n\tconsole.log(host);\r\n\t\r\n\tbuttons.prop('disabled', true);\r\n   \r\n\tfunction MQTTconnect() {\r\n\t\tif (typeof path == \"undefined\") {\r\n\t\t\tpath = '/mqtt';\r\n\t\t}\r\n\t\tmqtt = new Paho.MQTT.Client(\r\n\t\t\thost,\r\n\t\t\tport,\r\n\t\t\tpath,\r\n\t\t\t\"web_grafanaPanel\" + parseInt(Math.random() * 10000, 10)\r\n\t\t);\r\n\t\tvar options = {\r\n\t\t\ttimeout: 3,\r\n\t\t\tuseSSL: useTLS,\r\n\t\t\tcleanSession: cleansession,\r\n\t\t\tonSuccess: onConnect,\r\n\t\t\tonFailure: function (message) {\r\n\t\t\t\t$('#status_output').html(\"Connection failed: \" + message.errorMessage + \"Retrying\");\r\n\t\t\t\tsetTimeout(MQTTconnect, reconnectTimeout);\r\n\t\t\t}\r\n\t\t};\r\n\t\t\r\n\t\tmqtt.onConnectionLost = onConnectionLost;\r\n\t\tmqtt.onMessageArrived = timer_inbound;\r\n\t   \r\n\t\t\r\n\t\tif (user != null) {\r\n\t\t\toptions.userName = user;\r\n\t\t\toptions.password = pwd;\r\n\t\t}\r\n\t\tconsole.log(\"Host=\" + host + \", port=\" + port + \", path=\" + path + \" TLS = \" + useTLS + \" username=\" + user + \" password=\" + pwd);\r\n\t\tmqtt.connect(options);\r\n\t}\r\n\t\r\n\tfunction onConnect() {\r\n\t\t$('#status_output').html('Connected to: ' + host + ':' + port + path);\r\n\t\t// Connection succeeded; subscribe to our topic(s)\r\n\t\tbuttons.prop('disabled', false);\r\n\t}\r\n\r\n\tfunction onConnectionLost(response) {\r\n\t\tsetTimeout(MQTTconnect, reconnectTimeout);\r\n\t\t$('#status_output').html(\"connection lost: \" + response.errorMessage + \". Reconnecting\");\r\n\t\tbuttons.prop('disabled', true);\r\n\t};\r\n \r\n\tfunction timer_inbound(timer_message) {\r\n\t\tvar timer_output = timer_message.payloadString;\r\n\t\t$(\"#timer_output\").html(timer_output);\r\n\t}\r\n\r\n\tvar publish_timer = function (timer_payload) {\r\n\t\tmqtt.subscribe(\"output\", {\r\n\t\t\tqos: 2,\r\n\t\t});\r\n\r\n\t\tconsole.log(\"Sending: \" + JSON.stringify(timer_payload));\r\n\r\n\t\tvar timer_message = new Paho.MQTT.Message(timer_payload);\r\n\t\ttimer_message.destinationName = \"input\";\r\n\t\ttimer_message.qos = 2;\r\n\r\n\t\tmqtt.send(timer_message);\r\n\t\t\r\n\t\t// mqtt unsubscribe here if something goes havoc\r\n\r\n\t};\r\n \r\n\tif (typeof Paho === 'undefined') {\r\n\t\tvar script = document.createElement('script');\r\n\t\tdocument.body.appendChild(script);\r\n\t\tscript.onload = function () {\r\n\t\t\tMQTTconnect();\r\n\t\t}\r\n\t\tscript.src = '../public/mqttws31.min.js';\r\n\t} else {\r\n\t   MQTTconnect();\r\n\t}\r\n\r\n\u003c/script\u003e","mode":"html"},"pluginVersion":"10.1.5","targets":[{"datasource":{"type":"influxdb","uid":"8iwjhe17z"},"refId":"A"}],"transparent":true,"type":"text"},{"datasource":{"type":"influxdb","uid":"8iwjhe17z"},"gridPos":{"h":7,"w":6,"x":0,"y":10},"id":9,"options":{"code":{"language":"plaintext","showLineNumbers":false,"showMiniMap":false},"content":"\u0026nbsp;\u003ch3\u003eStandbykiller\u003c/h3\u003e\r\n\u003chr /\u003e\r\n\u003ccenter\u003e\r\n\u003cselect class=\"newform\" id=\"stby_device\" onchange=\"stby_onchange()\" name=\"nanolist_stbykill\"\u003e\r\n\t\u003coption value=\"\" selected disabled\u003e-- Gerät --\u003c/option\u003e\r\n\u003c/select\u003e\r\n\u003c/p\u003e\r\n\u003cinput class=\"newform\" id=\"stby_pwr\" placeholder=\"Standby-Grenze [W]\" onkeyup=\"stby_onkeyup()\" autocomplete=\"off\" /\u003e\r\n\u003c/p\u003e\r\n\u003cbutton title=\"Aktivieren\" id=\"stby_save\" class=\"newform\" onclick=\"standbykill('add')\" disabled\u003eSave\u003c/button\u003e\r\n\u003cbutton title=\"Alle Anzeigen\" id=\"stby_show\" class=\"newform\" onclick=\"standbykill('show all')\"\u003eShow\u003c/button\u003e\r\n\u003cbutton title=\"Deaktivieren\" id=\"stby_delete\" class=\"newform\" onclick=\"standbykill('remove')\" disabled\u003eDelete\u003c/button\u003e\r\n\u003c/p\u003e\r\n\u003c/center\u003e\r\n\u003cscript\u003e\r\n\r\n\tfunction standbykill(param) {\r\n\t\r\n\t\tvar stbydevice = document.getElementById(\"stby_device\").value;\r\n\t\tvar stbypwr = document.getElementById(\"stby_pwr\").value;\r\n\t\tvar text = document.getElementById(\"stby_device\");\r\n\t\tvar desc = text.options[text.selectedIndex].text;\r\n\t\t\r\n\t\tvar stdbykill = \"standbykiller \" + param + \" '\" + stbydevice + \"' '\" + desc + \"' '\" + stbypwr + \"'\";\r\n\r\n\t\tpublish_timer(stdbykill);\r\n\t\t\r\n\t};\r\n\r\n\tvar stby_onchange = function () {\r\n\t\tdocument.getElementById(\"stby_delete\").disabled = false;\r\n\t\tstby_enable_save()\r\n\t\tstandbykill('show')\r\n\t}\r\n\r\n\tvar stby_onkeyup = function () {\r\n\t\tvar stbydevice = document.getElementById(\"stby_device\")\r\n\t\tvar stbypwr = document.getElementById(\"stby_pwr\")\r\n\r\n\t\tif (stbydevice.value !== \"\" \u0026\u0026 stbypwr.value !== stbypwr.defaultValue ) {\r\n\t\t\tdocument.getElementById(\"stby_save\").disabled = false;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tdocument.getElementById(\"stby_save\").disabled = true;\r\n\t\t}\r\n\t};\r\n\r\n\t$(document).ready(function() {\r\n\t\t\t$('#stby_device').change(function() {\r\n\t\t\t\tvar current = $('#stby_device').val();\r\n\t\t\t\tif (current != 'null') {\r\n\t\t\t\t\t\t$('#select').css('color','white');\r\n\t\t\t\t\t\t$('#select').css('background-color','rgba(0,0,0,0.1)');\r\n\t\t\t\t} else {\r\n\t\t\t\t\t\t$('#select').css('color','white');\r\n\t\t\t\t\t\t$('#select').css('background-color','black');\r\n\t\t\t\t}\r\n\t\t\t}); \r\n\t});\r\n\r\n\u003c/script\u003e\r\n\r\n","mode":"html"},"pluginVersion":"10.1.5","targets":[{"datasource":{"type":"influxdb","uid":"8iwjhe17z"},"refId":"A"}],"type":"text"},{"datasource":{"type":"influxdb","uid":"8iwjhe17z"},"gridPos":{"h":6,"w":6,"x":0,"y":17},"id":10,"options":{"code":{"language":"plaintext","showLineNumbers":false,"showMiniMap":false},"content":"\u003ch3\u003eMultiswitch\u003c/h3\u003e\r\n\u003chr /\u003e\r\n\u003ccenter\u003e\r\n\u003cselect class=\"newform\" id=\"msw_dev1\" onchange=\"msw_onchange()\"\u003e\r\n\t\u003coption value=\"\" selected disabled\u003e-- Wenn --\u003c/option\u003e\r\n\u003c/select\u003e\r\n\u003c/p\u003e\r\n\u003cselect class=\"newform\" id=\"msw_dev2\" onchange=\"msw_onchange()\"\u003e\r\n\t\u003coption value=\"\" selected disabled\u003e-- Dann --\u003c/option\u003e\r\n\u003c/select\u003e\r\n\u003c/p\u003e\r\n\u003cbutton title=\"Aktivieren\" id=\"msw_save\" class=\"newform\" onclick=\"multiswitch('add')\" disabled\u003eSave\u003c/button\u003e\r\n\u003cbutton title=\"Alle Anzeigen\" id=\"msw_show\" class=\"newform\" onclick=\"multiswitch('show all')\"\u003eShow\u003c/button\u003e\r\n\u003cbutton title=\"Deaktivieren\" id=\"msw_delete\" class=\"newform\" onclick=\"multiswitch('remove')\" disabled\u003eDelete\u003c/button\u003e\r\n\u003c/center\u003e\r\n\u003cscript\u003e\r\n\r\n\tfunction multiswitch(param) {\r\n\t\tvar mswdev1 = document.getElementById(\"msw_dev1\").value;\r\n\t\tvar mswdev2 = document.getElementById(\"msw_dev2\").value;\r\n\r\n\t\tvar text1 = document.getElementById(\"msw_dev1\");\r\n\t\tvar desc1 = text1.options[text1.selectedIndex].text;\r\n\r\n\t\tvar text2 = document.getElementById(\"msw_dev2\");\r\n\t\tvar desc2 = text2.options[text2.selectedIndex].text;\r\n\r\n\t\tvar mswmessage = \"multiswitch \" + param + \" '\" + mswdev1 + \"' '\" + desc1 + \"' '\" + mswdev2 + \"' '\" + desc2 +  \"'\";\r\n\r\n\t\tpublish_timer(mswmessage);\r\n\t}\r\n\r\n\tvar msw_onchange = function () {\r\n\t\tvar mswdev1 = document.getElementById(\"msw_dev1\")\r\n\t\tvar mswdev2 = document.getElementById(\"msw_dev2\")\r\n\r\n\t\tif (mswdev1.value !== \"\" \u0026\u0026 mswdev2.value !== \"\" \u0026\u0026 mswdev1.value !== mswdev2.value) {\r\n\t\t\tdocument.getElementById(\"msw_save\").disabled = false;\r\n\t\t\tdocument.getElementById(\"msw_delete\").disabled = false;\r\n\t\t\tstandbykill('show')\r\n\t\t}\r\n\t\telse {\r\n\t\t\tdocument.getElementById(\"msw_save\").disabled = true;\r\n\t\t\tdocument.getElementById(\"msw_delete\").disabled = true;\r\n\t\t}\r\n\t}\r\n\r\n\t$(document).ready(function() {\r\n\t\t\t$('#msw_dev1').change(function() {\r\n\t\t\t\tvar current = $('#msw_dev1').val();\r\n\t\t\t\tif (current != 'null') {\r\n\t\t\t\t\t\t$('#select').css('color','white');\r\n\t\t\t\t\t\t$('#select').css('background-color','rgba(0,0,0,0.1)');\r\n\t\t\t\t} else {\r\n\t\t\t\t\t\t$('#select').css('color','white');\r\n\t\t\t\t\t\t$('#select').css('background-color','black');\r\n\t\t\t\t}\r\n\t\t\t}); \r\n\t\t\t\t\t\t$('#msw_dev2').change(function() {\r\n\t\t\t\tvar current = $('#msw_dev2').val();\r\n\t\t\t\tif (current != 'null') {\r\n\t\t\t\t\t\t$('#select').css('color','white');\r\n\t\t\t\t\t\t$('#select').css('background-color','rgba(0,0,0,0.1)');\r\n\t\t\t\t} else {\r\n\t\t\t\t\t\t$('#select').css('color','white');\r\n\t\t\t\t\t\t$('#select').css('background-color','black');\r\n\t\t\t\t}\r\n\t\t\t}); \r\n\t});\r\n\r\n\r\n\u003c/script\u003e\r\n","mode":"html"},"pluginVersion":"10.1.5","targets":[{"datasource":{"type":"influxdb","uid":"8iwjhe17z"},"refId":"A"}],"type":"text"}],"refresh":"","schemaVersion":38,"style":"dark","tags":[],"templating":{"list":[]},"time":{"from":"now-6h","to":"now"},"timepicker":{"hidden":true,"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"]},"timezone":"","title":"Schaltuhr","uid":"MCbNuLdVk","version":1,"weekStart":""}}