{"meta":{"type":"db","canSave":true,"canEdit":true,"canAdmin":true,"canStar":true,"canDelete":true,"slug":"settings","url":"/d/sYOGRUiRz/settings","expires":"0001-01-01T00:00:00Z","created":"2023-09-23T21:44:51+02:00","updated":"2023-10-14T22:25:06+02:00","updatedBy":"admin","createdBy":"admin","version":160,"hasAcl":false,"isFolder":false,"folderId":0,"folderUid":"","folderTitle":"General","folderUrl":"","provisioned":false,"provisionedExternalId":"","annotationsPermissions":{"dashboard":{"canAdd":true,"canEdit":true,"canDelete":true},"organization":{"canAdd":true,"canEdit":true,"canDelete":true}},"publicDashboardAccessToken":"","publicDashboardUid":"","publicDashboardEnabled":false},"dashboard":{"annotations":{"list":[{"$$hashKey":"object:156","builtIn":1,"datasource":{"type":"datasource","uid":"grafana"},"enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations \u0026 Alerts","target":{"limit":100,"matchAny":false,"tags":[],"type":"dashboard"},"type":"dashboard"}]},"editable":true,"fiscalYearStartMonth":0,"graphTooltip":0,"id":5,"links":[],"liveNow":false,"panels":[{"datasource":{"type":"influxdb","uid":"8iwjhe17z"},"gridPos":{"h":12,"w":6,"x":0,"y":0},"id":14,"links":[],"options":{"code":{"language":"plaintext","showLineNumbers":false,"showMiniMap":false},"content":"\u003ch4\u003eMQTT Device Manager\u003c/h4\u003e\r\n\u003chr /\u003e\r\n\u003ccenter\u003e\r\n\u003cselect class=\"newform\" id=\"devlist\" name=\"devlist\"\u003e\r\n\t\u003coption selected disabled\u003e-- Geräteliste --\u003c/option\u003e\r\n\u003c/select\u003e\r\n\u003c/p\u003e\r\n\u003cbutton title=\"Geräteliste anzeigen\" class=\"newform\" id=\"showdevs\" onclick=\"showdev()\"\u003eShow\u003c/button\u003e\r\n\u003cbutton title=\"Gerät entfernen\" class=\"newform\" id=\"deldev\" onclick=\"deldev()\" disabled\u003eDelete\u003c/button\u003e  \r\n\u003c/p\u003e\r\n\u003ch5\u003eGerät hinzufügen\u003c/h5\u003e\r\n\u003c/p\u003e\r\n\u003cinput class=\"newform\" id=\"devid\" placeholder=\"Device ID (shelly1-349454734815)\" onkeyup=\"dev_onkeyup()\" autocomplete=\"off\" /\u003e\r\n\u003c/p\u003e\r\n\u003cinput class=\"newform\" id=\"desc\" placeholder=\"Bezeichnung\" onkeyup=\"dev_onkeyup()\" autocomplete=\"off\" /\u003e\r\n\u003c/p\u003e\r\n\u003cselect class=\"newform\" id=\"component\" onchange=\"dev_enable_save()\"\u003e\r\n\t\u003coption value=\"\" selected disabled \u003e\u0026nbsp;\u0026nbsp;\u0026nbsp;Component\u003c/option\u003e\r\n\t\u003coption value=\"switch:0\"\u003eSwitch 0\u003c/option\u003e\r\n\t\u003coption value=\"switch:1\"\u003eSwitch 1\u003c/option\u003e\r\n\t\u003coption value=\"switch:2\"\u003eSwitch 2\u003c/option\u003e\r\n\t\u003coption value=\"switch:3\"\u003eSwitch 3\u003c/option\u003e\r\n\t\u003coption value=\"cover:0\"\u003eCover\u003c/option\u003e\r\n\t\u003coption value=\"ht\"\u003eShellyHT\u003c/option\u003e\r\n\u003c/select\u003e\r\n\r\n\u003c/p\u003e\r\n\u003cbutton id=\"savedev\" title=\"Gerät hinzufügen\" class=\"newform\" onclick=\"adddev()\" disabled\u003eSave\u003c/button\u003e\r\n\u003c/center\u003e\r\n\r\n\u003cscript\u003e\r\n\r\n\t$(\"#devlist\").change(function () {\r\n\t\t\tvar devlink = $(this).find(':selected').data('devlink');\r\n\r\n\t\t\tdocument.getElementById('show_dev').src=devlink;\r\n\t\t\tdocument.getElementById(\"deldev\").disabled = false;\r\n\t\t\tvar showdev_str = \"devmgmt show\";\r\n\t\t\tpublish_settings(showdev_str);\r\n\t});\r\n\r\n\tvar dev_onkeyup = function () {\r\n\t\tvar devid = document.getElementById(\"devid\")\r\n\t\tvar desc = document.getElementById(\"desc\")\r\n\t\tvar component = document.getElementById(\"component\")\r\n\r\n\t\tif (devid.value !== devid.defaultValue \u0026\u0026 desc.value !== desc.defaultValue \u0026\u0026 component.value !== \"\" ) {\r\n\t\t\tdocument.getElementById(\"savedev\").disabled = false;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tdocument.getElementById(\"savedev\").disabled = true;\r\n\t\t}\r\n\t};\r\n\r\n\tvar showdev = function () {\r\n\t\tvar showdev_str = \"devmgmt show\";\r\n\t\tpublish_settings(showdev_str);\r\n\t};\r\n\r\n\tvar adddev = function () {\r\n\t\tvar input_payload = \"\u003cfont size='5'\u003eGerät wird hinzugefügt\u003c/font\u003e\u003cbr\u003e\u003cbr\u003e\u003cfont size='4'\u003eBitte warten...\u003c/font\u003e\";\r\n\t\t$(\"#settings_output\").html(input_payload);\r\n\r\n\t\tvar devid = document.getElementById(\"devid\").value;\r\n\t\tvar desc = document.getElementById(\"desc\").value;\r\n\t\tvar component = document.getElementById(\"component\").value;\r\n\r\n\t\tvar adddev_str = \"devmgmt add '\" + devid + \"' '\" + desc + \"' '\" + component + \"'\";\r\n\r\n\t\tpublish_settings(adddev_str);\r\n\t};\r\n\r\n\tvar deldev = function () {\r\n\t\tvar input_payload = \"\u003cfont size='5'\u003eGerät wird gelöscht\u003c/font\u003e\u003cbr\u003e\u003cbr\u003e\u003cfont size='4'\u003eBitte warten...\u003c/font\u003e\";\r\n\t\t$(\"#settings_output\").html(input_payload);\r\n\r\n\t\tvar devid = document.getElementById(\"devlist\").value;\r\n\t\tvar text = document.getElementById(\"devlist\");\r\n\t\tvar desc = text.options[text.selectedIndex].text;\r\n\t\tvar remdev_str = \"devmgmt remove '\" + devid + \"' '\" + desc + \"'\";\r\n\r\n\t\tpublish_settings(remdev_str);\r\n\t};\r\n\r\n\t$(document).ready(function() {\r\n\t\t\t$('#component').change(function() {\r\n\t\t\t\tvar current = $('#component').val();\r\n\t\t\t\tif (current != 'null') {\r\n\t\t\t\t\t\t$('#select').css('color','white');\r\n\t\t\t\t\t\t$('#select').css('background-color','rgba(0,0,0,0.1)');\r\n\t\t\t\t} else {\r\n\t\t\t\t\t\t$('#select').css('color','white');\r\n\t\t\t\t\t\t$('#select').css('background-color','black');\r\n\t\t\t\t}\r\n\t\t\t}); \r\n\t});\r\n\r\n\u003c/script\u003e\r\n","mode":"html"},"pluginVersion":"10.1.5","targets":[{"datasource":{"type":"influxdb","uid":"8iwjhe17z"},"refId":"A"}],"type":"text"},{"datasource":{"type":"influxdb","uid":"8iwjhe17z"},"gridPos":{"h":20,"w":8,"x":6,"y":0},"id":26,"links":[],"options":{"code":{"language":"plaintext","showLineNumbers":false,"showMiniMap":false},"content":"\u003ciframe id=\"show_dev\" overflow=\"hidden\" scrolling=\"auto\" width=\"100%\" height=\"100%\" src=\"\"\u003e\u003c/iframe\u003e","mode":"html"},"pluginVersion":"10.1.5","transparent":true,"type":"text"},{"datasource":{"type":"influxdb","uid":"8iwjhe17z"},"gridPos":{"h":20,"w":10,"x":14,"y":0},"id":13,"options":{"code":{"language":"plaintext","showLineNumbers":false,"showMiniMap":false},"content":"\u003chead\u003e\u003clink rel=\"stylesheet\" type=\"text/css\" href=\"../public/style.css\" /\u003e\u003c/head\u003e\r\n\r\n\u003ch4\u003eOutput\u003c/h4\u003e\r\n\u003chr /\u003e\r\n\r\n\u003cdiv style=\"position: fixed; left: 50%; transform: translateX(-50%);\"\u003e\r\n\t\u003cbr /\u003e\r\n\t\u003cdiv\u003e\u003cspan id=\"settings_output\" style=\"text-align: left; white-space: pre; font-family: monospace; display: inline-block; unicode-bidi: embed;\"\u003e\u003c/span\u003e\u003c/div\u003e\r\n\u003c/div\u003e\r\n\r\n\u003cscript\u003e\r\n\t\r\n\tvar mqtt;\r\n\tvar reconnectTimeout = 5000;\r\n\tvar port = 1884;\r\n\tvar useTLS = false;\r\n\tvar user = \"\";\r\n\tvar pwd = \"\";\r\n\tvar cleansession = true;\r\n\tvar path = \"\";\r\n\tvar buttons = $('[type=button]');\r\n\tvar host = location.hostname;\r\n\t\r\n\tconsole.log(host);\r\n\t\r\n\tbuttons.prop('disabled', true);\r\n   \r\n\tfunction MQTTconnect() {\r\n\t\tif (typeof path == \"undefined\") {\r\n\t\t\tpath = '/mqtt';\r\n\t\t}\r\n\t\tmqtt = new Paho.MQTT.Client(\r\n\t\t\thost,\r\n\t\t\tport,\r\n\t\t\tpath,\r\n\t\t\t\"web_grafanaPanel\" + parseInt(Math.random() * 10000, 10)\r\n\t\t);\r\n\t\tvar options = {\r\n\t\t\ttimeout: 3,\r\n\t\t\tuseSSL: useTLS,\r\n\t\t\tcleanSession: cleansession,\r\n\t\t\tonSuccess: onConnect,\r\n\t\t\tonFailure: function (message) {\r\n\t\t\t\t$('#status_output').html(\"Connection failed: \" + message.errorMessage + \"Retrying\");\r\n\t\t\t\tsetTimeout(MQTTconnect, reconnectTimeout);\r\n\t\t\t}\r\n\t\t};\r\n\t\t\r\n\t\tmqtt.onConnectionLost = onConnectionLost;\r\n\t   mqtt.onMessageArrived = settings_inbound;\r\n\t   \r\n\t\t\r\n\t\tif (user != null) {\r\n\t\t\toptions.userName = user;\r\n\t\t\toptions.password = pwd;\r\n\t\t}\r\n\t\tconsole.log(\"Host=\" + host + \", port=\" + port + \", path=\" + path + \" TLS = \" + useTLS + \" username=\" + user + \" password=\" + pwd);\r\n\t\tmqtt.connect(options);\r\n\t}\r\n\t\r\n\tfunction onConnect() {\r\n\t\t$('#status_output').html('Connected to: ' + host + ':' + port + path);\r\n\t\t// Connection succeeded; subscribe to our topic(s)\r\n\t\tbuttons.prop('disabled', false);\r\n\t}\r\n\r\n\tfunction onConnectionLost(response) {\r\n\t\tsetTimeout(MQTTconnect, reconnectTimeout);\r\n\t\t$('#status_output').html(\"connection lost: \" + response.errorMessage + \". Reconnecting\");\r\n\t\tbuttons.prop('disabled', true);\r\n\t};\r\n \r\n\t var publish_settings = function (settings_payload) {\r\n\t\tmqtt.subscribe(\"output\", {\r\n\t\t\tqos: 2,\r\n\t\t});\r\n\r\n\t\tconsole.log(\"Sending: \" + JSON.stringify(settings_payload));\r\n\r\n\t\tvar settings_message = new Paho.MQTT.Message(settings_payload);\r\n\t\tsettings_message.destinationName = \"input\";\r\n\t\tsettings_message.qos = 2;\r\n\r\n\t\tmqtt.send(settings_message);\r\n\r\n\t\t// Unsubscribe here if something goes havoc (30s)\r\n\t\t\r\n\t};\r\n\r\n\t\r\n\r\n\tfunction settings_inbound(message) {\r\n\t\tvar input_payload = message.payloadString;\r\n\t\t$(\"#settings_output\").html(input_payload);\r\n\t}\r\n \r\n\r\n\tif (typeof Paho === 'undefined') {\r\n\t\tvar script = document.createElement('script');\r\n\t\tdocument.body.appendChild(script);\r\n\t\tscript.onload = function () {\r\n\t\t\tMQTTconnect();\r\n\t\t}\r\n\t\tscript.src = '../public/mqttws31.min.js';\r\n\t} else {\r\n\t   MQTTconnect();\r\n\t}\r\n\u003c/script\u003e","mode":"html"},"pluginVersion":"10.1.5","targets":[{"datasource":{"type":"influxdb","uid":"8iwjhe17z"},"refId":"A"}],"transparent":true,"type":"text"},{"datasource":{"type":"influxdb","uid":"8iwjhe17z"},"gridPos":{"h":8,"w":6,"x":0,"y":12},"id":20,"links":[],"options":{"code":{"language":"plaintext","showLineNumbers":false,"showMiniMap":false},"content":"\u003ch4\u003eMQTT User Manager\u003c/h4\u003e\r\n\u003chr /\u003e\r\n\r\n\u003ccenter\u003e\r\n\r\n\u003cinput class=\"newform\" id=\"mqtt_user\" requiredminlength=\"4\" placeholder=\"Username\" onkeyup=\"user_onkeyup()\" autocomplete=\"off\" /\u003e\r\n\r\n\u003c/p\u003e\r\n\r\n\u003cinput class=\"newform\" id=\"mqtt_pwd\" type=\"password\" requiredminlength=\"8\" placeholder=\"Password\" onkeyup=\"user_onkeyup()\" /\u003e\r\n\r\n\u003c/p\u003e\r\n\r\n\u003cbutton title=\"Hinzufügen\" id=\"adduser\" class=\"newform\" onclick=\"usermgmt('add');\" disabled\u003eSave\u003c/button\u003e\r\n\u003cbutton title=\"Löschen\" id=\"deluser\" class=\"newform\" onclick=\"usermgmt('remove');\" disabled\u003eDelete\u003c/button\u003e\r\n\u003c/p\u003e\r\n\u003cbutton title=\"Alle anzeigen\" id=\"showuser\" class=\"newform\" onclick=\"usermgmt('show');\"\u003eShow\u003c/button\u003e\r\n\u003cbutton title=\"Passwort zeigen\" id=\"showpwd\" class=\"newform\" onclick=\"show_mqtt_pw()\"\u003e\u0026#128065;\u003c/button\u003e\r\n\r\n\u003c/center\u003e\r\n\r\n\u003cscript\u003e\r\n\r\n\tvar user_onkeyup = function () {\r\n\t\r\n\t\tvar mqtt_user = document.getElementById(\"mqtt_user\")\r\n\t\tvar mqtt_pwd = document.getElementById(\"mqtt_pwd\")\r\n\r\n\t\tif (mqtt_user.value !== \"\" ) {\r\n\t\t\tdocument.getElementById(\"deluser\").disabled = false;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tdocument.getElementById(\"deluser\").disabled = true;\r\n\t\t}\r\n\r\n\t\tif (mqtt_user.value !== \"\" \u0026\u0026 mqtt_pwd.value !== \"\" ) {\r\n\t\t\tdocument.getElementById(\"adduser\").disabled = false;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tdocument.getElementById(\"adduser\").disabled = true;\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tfunction usermgmt(param) {\r\n\t\t\r\n\t\tvar mqtt_user = document.getElementById(\"mqtt_user\").value;\r\n\t\tvar mqtt_pwd = document.getElementById(\"mqtt_pwd\").value;\t\t\r\n\t\t\r\n\t\tvar usermgmt_message = \"usermgmt '\" + param + \"' '\" + mqtt_user + \"' '\" + mqtt_pwd + \"'\";\r\n\t\t\r\n\t\tpublish_settings(usermgmt_message);\r\n\t}\r\n\r\n\tfunction show_mqtt_pw() {\r\n\t\tvar x = document.getElementById(\"mqtt_pwd\");\r\n\t\tif (x.type === \"password\") {\r\n\t\t\tx.type = \"text\";\r\n\t\t} else {\r\n\t\t\tx.type = \"password\";\r\n\t\t}\r\n\t}\r\n\r\n\u003c/script\u003e\r\n","mode":"html"},"pluginVersion":"10.1.5","targets":[{"datasource":{"type":"influxdb","uid":"8iwjhe17z"},"refId":"A"}],"type":"text"}],"refresh":"","schemaVersion":38,"style":"dark","tags":[],"templating":{"list":[]},"time":{"from":"now-6h","to":"now"},"timepicker":{"hidden":true,"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"","title":"Settings","uid":"sYOGRUiRz","version":160,"weekStart":""}}